<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador Interativo da Arquitetura do Sistema</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap" rel="stylesheet">
    <!-- 
        Chosen Palette: Slate & Sky (Light Theme)
        Application Structure Plan: The SPA is structured as a single-page dashboard with a main navigation menu. It features three key interactive sections: 1) An 'Interactive Architecture' diagram where clicking a component reveals its details. 2) A 'Execution Flows' visualizer that guides the user step-by-step through processes like starting an app, highlighting the active component on the diagram. 3) A 'Key Components' section for detailed text. This structure was chosen to transform the linear document into a spatial and interactive learning tool, making the complex relationships between components easier to understand.
        Visualization & Content Choices: 
        - System Architecture: An interactive diagram built with HTML/Tailwind was chosen over a static list (Goal: Organize/Relate). Interaction: Click a component to see its details. Justification: Visually demonstrates the system's structure and component relationships.
        - Execution Flows: A step-by-step visualizer (Goal: Explain Change/Process). Interaction: Next/Previous buttons guide the user, highlighting the active component in the main diagram. Justification: Breaks down complex processes into manageable, easy-to-follow steps, linking them to the visual architecture.
        - Detailed Descriptions: Text panels that appear on interaction (Goal: Inform). Interaction: Content is revealed on-demand by clicking diagram components. Justification: Reduces initial cognitive load, presenting detailed information only when requested by the user.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fira-code {
            font-family: 'Fira Code', monospace;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .component-node {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .component-node.highlighted {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px #38bdf8; /* sky-400 */
        }
        .connector {
            position: absolute;
            background-color: #cbd5e1; /* slate-300 */
            z-index: -1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="min-h-screen flex flex-col md:flex-row">
        <!-- Main Navigation -->
        <nav class="bg-white border-b md:border-b-0 md:border-r border-slate-200 p-4">
            <h1 class="text-xl font-bold text-sky-600 mb-6">Sistema OS Web</h1>
            <ul class="space-y-2" id="main-nav">
                <li><a href="#overview" class="nav-link font-semibold text-slate-900 bg-sky-100/50 rounded-md px-3 py-2 block">Visão Geral</a></li>
                <li><a href="#architecture" class="nav-link font-semibold text-slate-600 hover:bg-slate-100 rounded-md px-3 py-2 block">Arquitetura Interativa</a></li>
                <li><a href="#flows" class="nav-link font-semibold text-slate-600 hover:bg-slate-100 rounded-md px-3 py-2 block">Fluxos de Execução</a></li>
                <li><a href="#components" class="nav-link font-semibold text-slate-600 hover:bg-slate-100 rounded-md px-3 py-2 block">Componentes</a></li>
                 <li><a href="#next-steps" class="nav-link font-semibold text-slate-600 hover:bg-slate-100 rounded-md px-3 py-2 block">Próximos Passos</a></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 p-6 md:p-10">
            <!-- Overview Section -->
            <section id="overview" class="content-section active">
                <h2 class="text-3xl font-bold mb-4">Visão Geral do Sistema</h2>
                <p class="text-lg text-slate-600 max-w-3xl">
                    Este é um visualizador interativo da arquitetura de um sistema operacional web simulado. A plataforma permite a execução de aplicativos com interface de usuário (janelas) e aplicativos de fundo (headless), gerenciando seus ciclos de vida e a comunicação entre eles. Navegue pelas seções para explorar os componentes, entender os fluxos de execução e ver o funcionamento do sistema.
                </p>
                <div class="mt-8 bg-sky-50 border-l-4 border-sky-400 text-sky-800 p-4 rounded-r-lg">
                    <p><strong>Como usar:</strong> Clique nos itens do menu à esquerda para navegar. Na seção "Arquitetura Interativa", clique em cada componente para ver seus detalhes. Na seção "Fluxos de Execução", siga os passos para visualizar os processos em ação.</p>
                </div>
            </section>

            <!-- Interactive Architecture Section -->
            <section id="architecture" class="content-section">
                <h2 class="text-3xl font-bold mb-2">Arquitetura Interativa</h2>
                <p class="text-slate-600 mb-8">Clique em um componente para ver suas responsabilidades.</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Diagram -->
                    <div id="diagram-container" class="relative w-full min-h-[600px] bg-slate-100/50 rounded-lg p-6">
                        <!-- Core Components -->
                        <div id="comp-app-manager" data-id="app-manager" class="component-node absolute top-6 left-1/2 -translate-x-1/2 w-48 bg-white p-4 rounded-lg shadow-md border-2 border-sky-500">
                            <h3 class="font-bold text-center">AppManager.js</h3>
                            <p class="text-xs text-center text-slate-500">Gerenciador Central</p>
                        </div>
                        <div id="comp-app-core" data-id="app-core" class="component-node absolute top-48 left-1/2 -translate-x-1/2 w-48 bg-white p-4 rounded-lg shadow-md border-2 border-slate-400">
                            <h3 class="font-bold text-center">AppCore.js</h3>
                            <p class="text-xs text-center text-slate-500">Camada de Orquestração</p>
                        </div>
                        <div id="comp-base-app" data-id="base-app" class="component-node absolute top-80 left-1/2 -translate-x-1/2 w-48 bg-white p-4 rounded-lg shadow-md border-2 border-slate-400">
                            <h3 class="font-bold text-center">BaseApp.js</h3>
                            <p class="text-xs text-center text-slate-500">Classe Base (Contrato)</p>
                        </div>

                        <!-- UI App Branch -->
                        <div id="comp-app-window" data-id="app-window" class="component-node absolute bottom-6 left-[15%] w-48 bg-white p-4 rounded-lg shadow-md border-2 border-green-500">
                            <h3 class="font-bold text-center">AppWindowSystem.js</h3>
                            <p class="text-xs text-center text-slate-500">Gerenciador de Janela</p>
                        </div>
                        <div id="comp-terminal-app" data-id="terminal-app" class="component-node absolute top-[55%] left-[15%] w-48 bg-white p-4 rounded-lg shadow-md border-2 border-green-400">
                            <h3 class="font-bold text-center">TerminalApp</h3>
                            <p class="text-xs text-center text-slate-500">App de UI (Exemplo)</p>
                        </div>

                        <!-- Headless App Branch -->
                        <div id="comp-headless-app" data-id="headless-app" class="component-node absolute top-[55%] right-[15%] w-48 bg-white p-4 rounded-lg shadow-md border-2 border-purple-400">
                            <h3 class="font-bold text-center">MyHeadlessApp</h3>
                             <p class="text-xs text-center text-slate-500">App Headless (Exemplo)</p>
                        </div>

                         <!-- Connectors -->
                        <div id="connectors"></div>
                    </div>
                    
                    <!-- Details Panel -->
                    <div id="details-panel" class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 id="details-title" class="text-xl font-bold mb-4">Selecione um Componente</h3>
                        <div id="details-content" class="text-slate-700 space-y-3">
                            <p>As responsabilidades do componente selecionado aparecerão aqui.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Execution Flows Section -->
            <section id="flows" class="content-section">
                <h2 class="text-3xl font-bold mb-2">Fluxos de Execução</h2>
                <p class="text-slate-600 mb-6">Selecione um fluxo e use os botões para navegar passo a passo.</p>
                
                <div class="mb-6">
                    <select id="flow-selector" class="p-2 border border-slate-300 rounded-md">
                        <option value="menu-start">Início de App via Menu</option>
                        <option value="terminal-start">Início de App via Terminal</option>
                    </select>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 id="flow-step-title" class="text-xl font-bold mb-2">Passo 1: Componente</h3>
                    <p id="flow-step-description" class="text-slate-700 min-h-[60px]">Descrição do passo atual do fluxo.</p>
                    <div class="mt-4 flex items-center space-x-4">
                        <button id="prev-step-btn" class="px-4 py-2 bg-slate-200 rounded-md font-semibold text-slate-700 disabled:opacity-50">Anterior</button>
                        <button id="next-step-btn" class="px-4 py-2 bg-sky-500 text-white rounded-md font-semibold">Próximo</button>
                        <span id="step-counter" class="text-sm text-slate-500"></span>
                    </div>
                </div>
            </section>
            
            <!-- Components Section -->
            <section id="components" class="content-section max-w-4xl">
                 <h2 class="text-3xl font-bold mb-4">Componentes Chave</h2>
                 <div id="components-list" class="space-y-6"></div>
            </section>
            
            <!-- Next Steps Section -->
            <section id="next-steps" class="content-section max-w-4xl">
                <h2 class="text-3xl font-bold mb-4">Próximos Passos e Melhorias Potenciais</h2>
                <ul id="next-steps-list" class="space-y-4 list-disc list-inside text-slate-700">
                </ul>
            </section>

        </main>
    </div>

    <script>
        const AppData = {
            "app-manager": {
                title: "AppManager.js",
                description: "O coração do sistema, atuando como um 'gerenciador de processos' central. É responsável por iniciar, rastrear e encerrar todos os aplicativos. Mantém listas separadas para apps com UI (`runningApps`) e apps de fundo (`runningHeadlessApps`), gerenciando o foco das janelas e os ícones na barra de tarefas."
            },
            "app-core": {
                title: "AppCore.js",
                description: "A camada intermediária que orquestra a execução de um aplicativo. Carrega o código do app, instancia sua classe principal e injeta APIs padrão, como os gerenciadores de `setTimeout` e `setInterval`. Ele garante que os recursos sejam limpos quando um app é encerrado."
            },
            "base-app": {
                title: "BaseApp.js",
                description: "A classe base abstrata que todos os aplicativos devem estender. Ela define um contrato com os métodos de ciclo de vida `onRun()` e `onCleanup()` e fornece acesso às APIs padrão injetadas pelo `AppCore`, promovendo um desenvolvimento consistente e modular."
            },
            "app-window": {
                title: "AppWindowSystem.js",
                description: "Responsável por criar e gerenciar a interface de uma janela. Ele renderiza a barra de título, botões de controle e a área de conteúdo. Crucialmente, ele chama o método `onRun()` do aplicativo somente após a janela ter sido totalmente adicionada ao DOM, garantindo a inicialização correta."
            },
            "terminal-app": {
                title: "TerminalApp (Exemplo)",
                description: "Uma implementação de um aplicativo com UI. Gerencia a entrada de comandos, o histórico e a exibição de saídas. Atua como um ponto de interação com o sistema, capaz de iniciar e parar outros processos."
            },
            "headless-app": {
                title: "MyHeadlessApp (Exemplo)",
                description: "Um aplicativo de fundo (headless) que executa uma tarefa sem interface visual. Demonstra como um processo pode receber parâmetros e enviar feedback para o terminal que o iniciou, usando a função de callback `appendToTerminal` injetada."
            },
            "next-steps": {
                title: "Próximos Passos",
                items: [
                    "<strong>Sistema de Arquivos Virtual:</strong> Implementar comandos como `ls`, `cd`, `mkdir`, `cat` que interagem com um sistema de arquivos simulado (usando `IndexedDB` ou `localStorage`).",
                    "<strong>Sistema de Notificações:</strong> Criar um sistema global de notificações que os aplicativos possam utilizar.",
                    "<strong>Comunicação Inter-App Genérica:</strong> Desenvolver um sistema de 'event bus' ou 'message broker' para permitir que aplicativos se comuniquem sem injeção direta de callbacks.",
                    "<strong>Gerenciamento de Estado Global:</strong> Introduzir uma solução como Redux simples ou Zustand para dados compartilhados.",
                    "<strong>Segurança (Sandbox):</strong> Executar aplicativos em Web Workers ou iFrames para maior isolamento e segurança."
                ]
            }
        };

        const FlowData = {
            "menu-start": {
                name: "Início de App via Menu",
                steps: [
                    { componentId: 'comp-app-manager', title: "1. AppManager", description: "`main.js` chama `manager.runApp(appId)` para iniciar o processo." },
                    { componentId: 'comp-app-core', title: "2. AppCore", description: "`AppManager` cria uma instância de `AppCore`, que carrega o código do aplicativo e instancia sua classe principal (ex: `TerminalApp`)." },
                    { componentId: 'comp-app-window', title: "3. AppWindowSystem", description: "Para um app de UI, `AppCore` cria uma instância de `AppWindowSystem`, que renderiza a janela no DOM." },
                    { componentId: 'comp-terminal-app', title: "4. TerminalApp", description: "`AppWindowSystem` chama o método `onRun()` do `TerminalApp` somente após a janela estar pronta, garantindo que o app possa acessar seus elementos HTML." }
                ]
            },
            "terminal-start": {
                name: "Início de App via Terminal",
                steps: [
                    { componentId: 'comp-terminal-app', title: "1. Terminal", description: "O usuário digita `start <appId>`. O `TerminalApp` processa o comando e passa a chamada, junto com sua função de callback `appendToTerminal`, para o `AppManager`." },
                    { componentId: 'comp-app-manager', title: "2. AppManager", description: "`AppManager` recebe a chamada e o callback. Ele cria uma instância do `AppCore` para o novo app." },
                    { componentId: 'comp-app-core', title: "3. AppCore", description: "`AppCore` instancia a classe do novo app (ex: `MyHeadlessApp`) e injeta as APIs padrão." },
                    { componentId: 'comp-headless-app', title: "4. MyHeadlessApp", description: "O `AppCore` chama `onRun()` no `MyHeadlessApp`, passando o callback do terminal. O app headless agora pode executar sua lógica e usar o callback para enviar mensagens de volta ao terminal." }
                ]
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');
            const diagramNodes = document.querySelectorAll('.component-node');
            const detailsTitle = document.getElementById('details-title');
            const detailsContent = document.getElementById('details-content');
            
            const flowSelector = document.getElementById('flow-selector');
            const prevStepBtn = document.getElementById('prev-step-btn');
            const nextStepBtn = document.getElementById('next-step-btn');
            const flowStepTitle = document.getElementById('flow-step-title');
            const flowStepDescription = document.getElementById('flow-step-description');
            const stepCounter = document.getElementById('step-counter');

            let currentFlowId = flowSelector.value;
            let currentStep = 0;

            function updateNav(hash) {
                navLinks.forEach(link => {
                    if (link.getAttribute('href') === hash) {
                        link.classList.add('text-slate-900', 'bg-sky-100/50');
                        link.classList.remove('text-slate-600', 'hover:bg-slate-100');
                    } else {
                        link.classList.remove('text-slate-900', 'bg-sky-100/50');
                        link.classList.add('text-slate-600', 'hover:bg-slate-100');
                    }
                });
            }

            function showSection(id) {
                sections.forEach(section => {
                    section.classList.toggle('active', section.id === id);
                });
                updateNav('#' + id);
            }

            // Navigation handler
            document.getElementById('main-nav').addEventListener('click', (e) => {
                if (e.target.tagName === 'A') {
                    e.preventDefault();
                    const id = e.target.getAttribute('href').substring(1);
                    showSection(id);
                    window.location.hash = id;
                }
            });
            
            // Initial section display based on hash or default
            const initialHash = window.location.hash ? window.location.hash : '#overview';
            showSection(initialHash.substring(1));


            // Architecture Diagram handler
            diagramNodes.forEach(node => {
                node.addEventListener('click', () => {
                    const id = node.dataset.id;
                    const data = AppData[id];
                    
                    diagramNodes.forEach(n => n.classList.remove('highlighted'));
                    node.classList.add('highlighted');
                    
                    detailsTitle.textContent = data.title;
                    detailsContent.innerHTML = `<p>${data.description}</p>`;
                });
            });

            // Flow Visualizer handler
            function updateFlowStep() {
                const flow = FlowData[currentFlowId];
                const step = flow.steps[currentStep];

                flowStepTitle.textContent = step.title;
                flowStepDescription.textContent = step.description;
                
                diagramNodes.forEach(node => {
                    node.classList.toggle('highlighted', node.id === step.componentId);
                });

                stepCounter.textContent = `Passo ${currentStep + 1} de ${flow.steps.length}`;
                prevStepBtn.disabled = currentStep === 0;
                nextStepBtn.disabled = currentStep === flow.steps.length - 1;
            }

            flowSelector.addEventListener('change', () => {
                currentFlowId = flowSelector.value;
                currentStep = 0;
                updateFlowStep();
            });

            nextStepBtn.addEventListener('click', () => {
                const flow = FlowData[currentFlowId];
                if (currentStep < flow.steps.length - 1) {
                    currentStep++;
                    updateFlowStep();
                }
            });

            prevStepBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    updateFlowStep();
                }
            });
            
            // Populate dynamic lists
            const componentsList = document.getElementById('components-list');
            Object.keys(AppData).forEach(key => {
                if (key !== 'next-steps') {
                    const item = AppData[key];
                    componentsList.innerHTML += `
                        <div class="pt-4 border-t border-slate-200">
                           <h3 class="text-xl font-bold mb-2">${item.title}</h3>
                           <p class="text-slate-600">${item.description}</p>
                        </div>
                    `;
                }
            });
            
            const nextStepsList = document.getElementById('next-steps-list');
            AppData['next-steps'].items.forEach(item => {
                nextStepsList.innerHTML += `<li>${item}</li>`;
            });
            
            // Initial state for flow
            updateFlowStep();
            
            // Function to draw connectors in the diagram
            function drawConnectors() {
                const container = document.getElementById('diagram-container');
                const connectorsDiv = document.getElementById('connectors');
                connectorsDiv.innerHTML = ''; // Clear existing connectors
                
                const connections = [
                    ['comp-app-manager', 'comp-app-core'],
                    ['comp-app-core', 'comp-base-app'],
                    ['comp-base-app', 'comp-terminal-app'],
                    ['comp-base-app', 'comp-headless-app'],
                    ['comp-app-core', 'comp-app-window'],
                ];
                
                connections.forEach(([startId, endId]) => {
                    const startEl = document.getElementById(startId);
                    const endEl = document.getElementById(endId);
                    
                    if (!startEl || !endEl) return;
                    
                    const startRect = startEl.getBoundingClientRect();
                    const endRect = endEl.getBoundingClientRect();
                    const containerRect = container.getBoundingClientRect();

                    const startX = startRect.left + startRect.width / 2 - containerRect.left;
                    const startY = startRect.top + startRect.height - containerRect.top;
                    const endX = endRect.left + endRect.width / 2 - containerRect.left;
                    const endY = endRect.top - containerRect.top;

                    const line = document.createElement('div');
                    line.classList.add('connector');
                    line.style.left = `${startX}px`;
                    line.style.top = `${startY}px`;
                    line.style.width = '2px';
                    line.style.height = `${endY - startY}px`;
                    
                    const horizontalLine = document.createElement('div');
                    horizontalLine.classList.add('connector');
                    horizontalLine.style.left = `${Math.min(startX, endX)}px`;
                    horizontalLine.style.top = `${endY}px`;
                    horizontalLine.style.height = '2px';
                    horizontalLine.style.width = `${Math.abs(startX - endX)}px`;

                    connectorsDiv.appendChild(line);
                    connectorsDiv.appendChild(horizontalLine);
                });
            }

            // Draw connectors on load and resize
            drawConnectors();
            window.addEventListener('resize', drawConnectors);
        });
    </script>
</body>
</html>